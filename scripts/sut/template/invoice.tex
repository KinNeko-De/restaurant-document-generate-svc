%% LyX 2.3.7 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass{scrartcl}
\usepackage[T1]{fontenc}
\usepackage{array}
\usepackage{polyglossia}
\usepackage{luacode}
\setdefaultlanguage{german}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

%% includes the model of the invoice
%% file is filled with test data
%% on every request a specific model for the request will be generated
%% do not try to load model.lua because somewhere is another model.lua that will be loaded
\directlua{ model = require("./invoice.lua")}

\begin{document}
\begin{minipage}[t]{0.4\columnwidth}%
\begin{flushleft}
restaurant.think.different
\par\end{flushleft}%
\end{minipage} \hfill{}%
\begin{minipage}[t]{0.4\columnwidth}%
\begin{flushright}
Rechnung
\par\end{flushright}%
\end{minipage}

\bigskip{}

\begin{minipage}[t]{0.4\columnwidth}
\directlua{tex.print(model.invoice.recipient.name)}

\directlua{tex.print(model.invoice.recipient.street)}

\directlua{tex.print(model.invoice.recipient.city)}, \directlua{tex.print(model.invoice.recipient.postCode)}

\directlua{tex.print(model.invoice.recipient.country)}
\end{minipage}
\hfill{}%
\begin{minipage}[t]{0.4\columnwidth}%
{Referenznummer XXX}{\par}

{Verkauf durch Verkäufer}{\par}

{\rule[0.5ex]{1\columnwidth}{1pt}}{\par}

{Rechnungsdatum /}\\
{Lieferdatum \luaexec{tex.sprint(os.date("\%d.\%m.\%Y", model.invoice.deliveredOn.seconds))}}{\par}%
\end{minipage}

\vspace{10ex}

Rechnungsdetails

\hfill{}%
\begin{minipage}[t]{1\columnwidth}%
    \begin{luacode}
    tex.print("\\begin{tabular*}{0.99\\columnwidth}{@{\\extracolsep{\\fill}}>{\\raggedright}p{0.3\\columnwidth}rrrrr}")
    tex.print("{Beschreibung} & {Menge} & {Stückpreis} & {USt. \\%} & {Stückpreis} & {Summe}\\tabularnewline")
    for _, item in ipairs(model.invoice.items) do
      tex.sprint("{", item.description, "}", " & ")
      tex.sprint("{", item.quantity, "}", " & ")
      tex.sprint("{", item.netAmount, " €}", " & ")
      tex.sprint("{", item.taxation, " \\%}", " & ")
      tex.sprint("{", item.totalAmount, " €}", " & ")
      tex.print("{", item.sum, " €}", "\\tabularnewline")
    end
    tex.print("\\end{tabular*}")
    \end{luacode}
\end{minipage}

\hfill{}%
\begin{minipage}[t]{0.3\columnwidth}%
Gesamtpreis%
\end{minipage}%
\noindent\begin{minipage}[t]{0.1\columnwidth}%
\begin{flushright}
18,77 €
\end{flushright}%
\end{minipage}
\end{document}
